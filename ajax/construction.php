<?    require_once($_SERVER["DOCUMENT_ROOT"] . "/bitrix/modules/main/include/prolog.php");    if (!CModule::IncludeModule('iblock') || !CModule::IncludeModule("catalog")) {        exit;    }    global $iblockid;    $mode = $_REQUEST['mode'];    if ($mode = 'get') {        $db_list = CIBlockElement::GetByID($_REQUEST['id']);        if ($product = $db_list->GetNextElement()) {            $elem = array_merge($product->GetFields(), $product->GetProperties());            if (is_array($elem['COMPOSITEPART']['VALUE']) && count($elem['COMPOSITEPART']['VALUE'])) {                $result = array();                foreach ($elem['COMPOSITEPART']['VALUE'] as $comp_item) {                    $arFilter = Array('IBLOCK_ID'=>$iblockid, 'ID'=>$comp_item);                    $db_list = CIBlockElement::GetList(Array(), $arFilter);                    $product_item_part = $db_list->GetNextElement();                    if (!$product_item_part) continue;                    $product_item_part = array_merge($product_item_part->GetFields(), $product_item_part->GetProperties());                    if($product_item_part['NO_ORDER']['VALUE'] == 'Y') continue;                    $web_path = web_path($product_item_part);                    $img_path = get_resized_img($web_path,322,322);                    if($img_path == '' || !$img_path) $img_path = $web_path;                    $img = $img_path;                    $uri = __get_product_link($product_item_part);                    $temp = array(                        'ID' => $product_item_part['ID'],                        'NAME' => __get_product_name($product_item_part),                        'URL' => $uri,                        'IMAGE' => $img[0],                        'TRUE_PRICE' => __get_product_cost($product_item_part),                        'PRICE' => __cost_format($cost)                    );                    array_push($result, $temp);                }                echo json_encode($result);            } else {                echo 1;            }        } else {            echo 0;        }    }?>