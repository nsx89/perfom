/*
.......................................................
.                Выбор месяца и года                  .
.                версия от 18.08.2015                 .
.                                                     .
.                  (C) By Protocoder                  .
.                     protocoder.ru                   .
.                                                     .
. распространяется по лицензии Creative Commons BY-NC .
.   http://creativecommons.org/licenses/by-nc/3.0/    .
.......................................................
*/

function ymCal(t,e,n,o,c,s,i,a){var l=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],r=new Date,d=r.getFullYear(),f=r.getMonth()+1;null==o&&(o=f),(o<1||12<o)&&(o=0),null==c&&(c=d);var u=0!==c&&(c<d-3||d+2<c)?c-3:d-3;i=i||100,e=e||document.body,null==a&&(a=5),"left"!=n&&"right"!=n&&"top"!=n&&"bottom"!=n&&(n="right");var v=$(t),m='<div class="ymCal ym'+n.substring(0,1).toUpperCase()+n.substring(1)+'"><div class="msg"><table cellspacing="0" cellpadding="0" border="0">';m+='<tr><td colspan="2" class="mc"><div class="btn mDec"><i class="icon-angle-up"></i></div></td><td class="yc"><div class="btn yDec"><i class="icon-angle-up"></i></div></td></tr>';for(var p=0,g=1,y=7,b=u;p<6;p++,g++,y++,b++)m+="<tr>",m+='<td class="m" data-m="'+g+'"><div><span>'+(g<10?"0":"")+g+". </span>"+l[g-1].toLowerCase()+"</div></td>",m+='<td class="m" data-m="'+y+'"><div><span>'+(y<10?"0":"")+y+". </span>"+l[y-1].toLowerCase()+"</div></td>",m+='<td class="y" data-y="'+b+'"><div>'+b+"</div></td></tr>";m+='<tr><td colspan="2" class="mc"><div class="btn mInc"><i class="icon-angle-down"></i></div></td><td class="yc"><div class="btn yInc"><i class="icon-angle-down"></i></div></td></tr>',m+='</table><div class="btn ok">ОК</div><div class="btn curDate" title="текущая дата"><i class="icon-check-1"></i></div><div class="btn cancel">ОТМЕНА</div></div></div>';var h=$(m);h.css({position:"absolute",display:"none",opacity:0,"z-index":i}),h.appendTo(e),m=void 0;var w={get:function(){return{cMonth:f,cYear:d,sYear:u,month:o||null,year:c||null,obj:v[0],dom:h[0],interface:w}},clear:function(){o=c=0,I()},set:function(t,e,s,n,i){o=o&&t,n&&(f=n),i&&(d=i),s&&(u=s),(c=c&&e)&&c<u&&!s&&(u=c-3),H(),I()},show:function(t){var e,s;t?0<h.css("opacity")||(h.stop(!0,!1),e=v.offset(),s=v.outerWidth(),t=v.outerHeight(),h.css({display:"inline-block",opacity:0}),"right"==n&&(e.left+=a+s,e.top+=(t>>1)-(h.outerHeight(!0)>>1)),"left"==n&&(e.left+=a-h.outerWidth(!0),e.top+=(t>>1)-(h.outerHeight(!0)>>1)),"top"==n&&(e.left+=(s>>1)-(h.outerWidth()>>1),e.top+=a-h.outerHeight(!0)),"bottom"==n&&(e.left+=(s>>1)-(h.outerWidth(!0)>>1),e.top+=a+t),h.css({left:e.left+"px",top:e.top+"px"}),e=void 0,$(document).off("mousedown",k).on("mousedown",k),h.fadeTo("fast",1),C("show")):"none"!=h.css("display")&&k()}};function k(t){if(t){if(t.target&&$.contains(h[0],t.target))return;C("outside")}h.stop(!0,!1).fadeTo("fast",0,function(){h.css("display","none")}),$(document).off("mousedown",k),C("hide")}function C(t){s&&s(t,o||0,c||0,w.get())}C("created");var D=h.find(".m"),A=h.find(".y");function I(){D.removeClass("cur"),A.removeClass("cur").filter("[data-y="+d+"]:first").addClass("cur"),c==d&&D.filter("[data-m="+f+"]:first").addClass("cur"),D.removeClass("sel").filter("[data-m="+o+"]:first").addClass("sel"),A.removeClass("sel").filter("[data-y="+c+"]:first").addClass("sel")}function H(){for(var t=0;t<A.length;t++)A.eq(t).attr("data-y",u+t).find("div:first").html(u+t)}return I(),h.click(function(t){for(var e=t.target;e&&"TD"!=e.tagName;)e=e.parentNode;e&&(e.hasAttribute("data-m")&&(o=parseInt(e.getAttribute("data-m"),10)),e.hasAttribute("data-y")&&(c=parseInt(e.getAttribute("data-y"),10)),I())}),h.find(".mInc:first").click(function(t){if(o){if(12<++o)return o=1,void h.find(".yInc:first").click()}else o=1;I()}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),h.find(".mDec:first").click(function(t){if(o){if(--o<1)return o=12,void h.find(".yDec:first").click()}else o=12;I()}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),h.find(".yInc:first").click(function(t){c?c++:c=d,u+6<=c&&u++,H(),I()}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),h.find(".yDec:first").click(function(t){c?c--:c=d,c<u&&u--,H(),I()}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),h.find(".ok:first").click(function(t){C("ok"),k()}),h.find(".curDate:first").click(function(t){(d<u||u+6<=d)&&(u=d-3),H(),o=f,c=d,I()}),h.find(".cancel:first").click(function(t){t.stopPropagation(),C("cancel"),k()}),v.click(function(){w.show(!0)}),w}